<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Atiestatīt paroli</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    .container { max-width: 400px; margin: 50px auto; padding: 20px; }
    .form-group { display: flex; flex-direction: column; gap: 12px; }
    .input-field { padding: 10px; font-size: 1em; text-align: center; }
    .btn { padding: 12px; font-size: 1em; }
    .error { color: red; font-size: 0.9em; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><h1>Latgales Zoodārzs</h1></div>
    <h2>Atiestatīt paroli</h2>
    <div class="form-group">
      <input type="password" id="newPassword" placeholder="Jaunā parole" class="input-field">
      <input type="password" id="confirmPassword" placeholder="Apstiprināt paroli" class="input-field">
      <button onclick="resetPassword()" class="btn btn-primary">Iestatīt jauno paroli</button>
      <div id="error" class="error"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    if (!token) {
      document.body.innerHTML = '<h2 style="text-align:center;color:red;">Nederīga saite</h2>';
    }

    function resetPassword() {
      const pass1 = document.getElementById('newPassword').value;
      const pass2 = document.getElementById('confirmPassword').value;
      const error = document.getElementById('error');

      if (pass1 !== pass2) return error.textContent = 'Paroles nesakrīt';
      if (pass1.length < 4) return error.textContent = 'Parole pārāk īsa (min. 4 zīmes)';

      fetch('/api/reset-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password: pass1 })
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          alert('Parole atjaunota! Tagad varat pieteikties.');
          location.href = '/login.html';
        } else {
          error.textContent = data.error || 'Kļūda';
        }
      })
      .catch(() => error.textContent = 'Servera kļūda');
    }
  </script>
</body>
</html>